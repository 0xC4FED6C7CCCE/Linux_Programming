# Linux系统编程



## GCC编译命令



假设源程序文件名为test.c。

1. 无选项编译链接
   用法：#gcc test.c
   作用：将test.c预处理、汇编、编译并链接形成可执行文件。这里未指定输出文件，默认输出为a.out。

2. 选项 -o
   用法：#gcc test.c -o test
   作用：将test.c预处理、汇编、编译并链接形成可执行文件test。-o选项用来指定输出文件的文件名。

3. 选项 -E
   用法：#gcc -E test.c -o test.i
   作用：将test.c预处理输出test.i文件。

4. 选项 -S
   用法：#gcc -S test.i
   作用：将预处理输出文件test.i汇编成test.s文件。

5. 选项 -c
   用法：#gcc -c test.s
   作用：将汇编输出文件test.s编译输出test.o文件。

6. 无选项链接
   用法：#gcc test.o -o test
   作用：将编译输出文件test.o链接成最终可执行文件test。

7. 选项-O
   用法：#gcc -O1 test.c -o test
   作用：使用编译优化级别1编译程序。级别为1~3，级别越大优化效果越好，但编译时间越长。





## VIM基本使用



### 1. vi的基本概念
基本上vi可以分为三种状态，分别是命令模式（command mode）、插入模式（Insert mode）和底行模式（last line mode），各模式的功能区分如下：



|            模式            |                             作用                             |
| :------------------------: | :----------------------------------------------------------: |
|  插入模式（Insert mode）   | 控制屏幕光标的移动，字符、字或行的删除，移动复制某区段及进入Insert mode下，或者到 last line mode。 |
| 命令行模式(command mode）  | 只有在Insert mode下，才可以做文字输入，按「ESC」键可回到命令行模式。 |
| 底行模式（last line mode） | 将文件保存或退出vi，也可以设置编辑环境，如寻找字符串、列出行号……等。不过一般我们在使用时把vi简化成两个模式，就是将底行模式（last line mode）也算入命令行模式command mode）。 |



### 2. vi的基本操作

|       功能       |                             命令                             |
| :--------------: | :----------------------------------------------------------: |
|     进入vim      |                       $ vim [filename]                       |
|  切换至插入模式  |    在「命令行模式」下按一下字母 i 就可以进入「插入模式」     |
|  转到命令行模式  |                          按一下ESC                           |
| 退出vi及保存文件 | 在命令行模式下，按一下：冒号键进入Last line mode，<br/>例如 w filename （输入 w filename将文章以指定的文件名filename保存）<br/>: wq (输入wq，存盘并退出vi)<br/>: q! (输入q!  不存盘强制退出vi) |

### 3. 命令行模式功能键

1）. 插入模式
按「i」切换进入插入模式「insert mode」，按“i”进入插入模式后是从光标当前位置开始输入文件；
按「a」进入插入模式后，是从目前光标所在位置的下一个位置开始输入文字；
按「o」进入插入模式后，是插入新的一行，从行首开始输入文字。



2）. 从插入模式切换为命令行模式
按「ESC」键。



3）. 移动光标
vi可以直接用键盘上的光标来上下左右移动，但正规的vi是用小写英文字母「h」、「j」、「k」、「l」，分别控制光标左、下、上、右移一格。



按「ctrl」+「b」：屏幕往“后”移动一页。
按「ctrl」+「f」：屏幕往“前”移动一页。
按「ctrl」+「u」：屏幕往“后”移动半页。
按「ctrl」+「d」：屏幕往“前”移动半页。
按数字「0」：移到文章的开头。
按「G」：移动到文章的最后。
按「$」：移动到光标所在行的“行尾”。
按「^」：移动到光标所在行的“行首”
按「w」：光标跳到下个字的开头
按「e」：光标跳到下个字的字尾
按「b」：光标回到上个字的开头
按「#l」：光标移到该行的第#个位置，如：5l,56l。



4）. 删除文字
「x」：每按一次，删除光标所在位置的“后面”一个字符。
「#x」：例如，「6x」表示删除光标所在位置的“后面”6个字符。
「X」：大写的X，每按一次，删除光标所在位置的“前面”一个字符。
「#X」：例如，「20X」表示删除光标所在位置的“前面”20个字符。
「dd」：删除光标所在行。
「#dd」：从光标所在行开始删除#行



5）. 复制
「yw」：将光标所在之处到字尾的字符复制到缓冲区中。
「#yw」：复制#个字到缓冲区
「yy」：复制光标所在行到缓冲区。
「#yy」：例如，「6yy」表示拷贝从光标所在的该行“往下数”6行文字。
「p」：将缓冲区内的字符贴到光标所在位置。注意：所有与“y”有关的复制命令都必须与“p”配合才能完成复制与粘贴功能。



6）. 替换
「r」：替换光标所在处的字符。
「R」：替换光标所到之处的字符，直到按下「ESC」键为止。



7）. 回复上一次操作
「u」：如果您误执行一个命令，可以马上按下「u」，回到上一个操作。按多次“u”可以执行多次回复。



8）. 更改
「cw」：更改光标所在处的字到字尾处
「c#w」：例如，「c3w」表示更改3个字



9）. 跳至指定的行
「ctrl」+「g」列出光标所在行的行号。
「#G」：例如，「15G」，表示移动光标至文章的第15行行首。



### 4. Last line mode下命令简介

　　在使用「last line mode」之前，请记住先按「ESC」键确定您已经处于「command mode」下后，再按「：」冒号即可进入「last line mode」。

1. 列出行号
   「set nu」：输入「set nu」后，会在文件中的每一行前面列出行号。

2. 跳到文件中的某一行
   「#」：「#」号表示一个数字，在冒号后输入一个数字，再按回车键就会跳到该行了，如输入数字15，再回车，就会跳到文章的第15行。

3. 查找字符
   「/关键字」：先按「/」键，再输入您想寻找的字符，如果第一次找的关键字不是您想要的，可以一直按「n」会往后寻找到您要的关键字为止。
   「?关键字」：先按「?」键，再输入您想寻找的字符，如果第一次找的关键字不是您想要的，可以一直按「n」会往前寻找到您要的关键字为止。

4. 保存文件
   「w」：在冒号输入字母「w」就可以将文件保存起来。

5.  离开vi
   「q」：按「q」就是退出，如果无法离开vi，可以在「q」后跟一个「!」强制离开vi。
   「qw」：一般建议离开时，搭配「w」一起使用，这样在退出的时候还可以保存文件。



## Linux 下objdump使用

**linux下objdump命令常见用法举例:**

|              命令              |                             作用                             |
| :----------------------------: | :----------------------------------------------------------: |
|         objdump -x obj         | 以某种分类信息的形式把目标文件的数据组成输出；<可查到该文件的的所有动态库> |
|         objdump -t obj         |                     输出目标文件的符号表                     |
|         objdump -h obj         |                   输出目标文件的所有段概括                   |
| objdump -j ./text/.data -S obj |               输出指定段的信息（反汇编源代码）               |
|         objdump -S obj         |        输出目标文件的符号表（）  当gcc -g时打印更明显        |



## GDB调试

gdb命令包含在GNU的gcc开发套件中，是功能强大的程序调试器。

gdb中的命令很多，但我们只需掌握其中十个左右的命令，就大致可以完成日常的基本的程序调试工作。

**语法格式：**gdb [参数] [文件]

**常用参数：**

| -cd  | 设置工作目录                       |
| ---- | ---------------------------------- |
| -q   | 安静模式，不打印介绍信息和版本信息 |
| -d   | 添加文件查找路径                   |
| -x   | 从指定文件中执行GDB指令            |
| -s   | 设置读取的符号表文件               |

**常用命令：**

| file <文件名> | 加载被调试的可执行程序文件                       |
| ------------- | ------------------------------------------------ |
| run           | 重新开始运行文件                                 |
| start         | 单步执行，运行程序，停在第一执行语句             |
| list          | 查看原代码，简写l                                |
| set           | 设置变量的值                                     |
| next          | 单步调试（逐过程，函数直接执行）,简写n           |
| step          | 单步调试（逐语句：跳入自定义函数内部执行）,简写s |
| backtrace     | 查看函数的调用的栈帧和层级关系,简写bt            |
| frame         | 切换函数的栈帧,简写f                             |
| info          | 查看函数内部局部变量的数值,简写i                 |
| finish        | 结束当前函数，返回到函数调用点                   |
| continue      | 继续运行,简写c                                   |
| print         | 打印值及地址,简写p                               |
| quit          | 退出gdb,简写q                                    |

gdb命令拥有较多内部命令。在gdb命令提示符“(gdb)”下输入“help”可以查看所有内部命令及使用说明。要使用gdb调试程序，在使用gcc编译源代码时必须加上“-g”参数。

**参考实例**

启动gdb调试器：

```shell
[root@linuxcool ~]# gdb
(gdb)
```

加载二进制可执行程序：

```shell
(gdb)file linuxcool.out
```

运行并跟踪程序：

```shell
(gdb)start
```